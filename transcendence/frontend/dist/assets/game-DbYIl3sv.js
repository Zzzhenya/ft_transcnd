function y(e){const o=e.court.width-96,s=e.court.height-48*2;return{x:48,y:48,w:o,h:s,left:48,top:48,right:48+o,bottom:48+s}}const g={court:{width:960,height:540,gutter:24},paddle:{width:16,height:96,speed:520},ball:{radius:8,speed:420},winScore:5,roundTimeSec:0,roundsToWin:2};function W(e){const n=e.court.width,t=e.court.height,o=e.paddle.width,s=e.paddle.height,r=e.court.gutter;if(r<0)throw new Error("Gutter must be >= 0");if(r+o>n)throw new Error("Paddle width + gutter exceeds court width");if(s>t)throw new Error("Paddle height exceeds court height")}function C(e,n){const t=y(n);return e==="left"?t.x+n.court.gutter:t.right-n.court.gutter-n.paddle.width}function w(e,n=g){const t=n.court.height,o=n.paddle.width,s=n.paddle.height,r=n.paddle.speed,i=C(e,n),d=(t-s)/2;return{posX:i,posY:d,width:o,height:s,vy:0,speed:r}}function R(e=g){const n=y(e);return{pos:{x:n.x+n.w/2,y:n.y+n.h/2},vel:{x:0,y:0},radius:e.ball.radius}}function P(e=g){W(e);const n=e.roundsToWin??2;return{status:"ready",score:{left:0,right:0},ball:R(e),winner:null,matchWinner:null,roundWinner:null,round:1,roundWins:{left:0,right:0},roundsToWin:n,leftPaddle:w("left",e),rightPaddle:w("right",e),startMs:Date.now(),elapsedMs:0,lastUpdateMs:performance.now(),remainingMs:e.roundTimeSec*1e3}}function k(){return Math.random()<.5?"left":"right"}function A(e=15,n=45){if(n<e){const i=e;e=n,n=i}const t=e*Math.PI/180,o=n*Math.PI/180,s=t+Math.random()*(o-t);let r=1;return Math.random()<.5&&(r=-1),r*s}function b(e,n=g,t=k()){const o=n.ball.speed,s=A(15,45);let r=1;t==="left"&&(r=-1);const i=y(n);e.ball.pos.x=i.x+i.w/2,e.ball.pos.y=i.y+i.h/2,e.ball.vel.x=Math.cos(s)*o*r,e.ball.vel.y=Math.sin(s)*o,e.status="playing"}function x(e,n=g){const t=y(n);e.leftPaddle.posX=t.x+n.court.gutter,e.rightPaddle.posX=t.right-n.court.gutter-n.paddle.width,e.leftPaddle.posY=t.y+(t.h-n.paddle.height)/2,e.rightPaddle.posY=t.y+(t.h-n.paddle.height)/2,e.leftPaddle.vy=0,e.rightPaddle.vy=0,e.ball=R(n),e.status="ready"}function E(){const e={upLeft:!1,dwLeft:!1,upRight:!1,dwRight:!1,pause:!1,reset:!1};function n(r,i){switch(i.key){case"w":case"W":e.upLeft=r,r&&i.preventDefault();break;case"s":case"S":e.dwLeft=r,r&&i.preventDefault();break;case"ArrowUp":e.upRight=r,r&&i.preventDefault();break;case"ArrowDown":e.dwRight=r,r&&i.preventDefault();break;case"p":case"P":r&&!i.repeat&&(e.pause=!e.pause);break;case"r":case"R":r&&!i.repeat&&(e.reset=!0);break}}function t(r){n(!0,r)}function o(r){n(!1,r)}function s(r){return r.addEventListener("keydown",t),r.addEventListener("keyup",o),()=>{r.removeEventListener("keydown",t),r.removeEventListener("keyup",o)}}return{state:e,attach:s}}function L(e,n,t){const{width:o,height:s}=t.court,{x:r,y:i,w:d,h:a}=y(t);e.clearRect(0,0,o,s),e.save(),e.lineWidth=2,e.strokeStyle="#222",e.strokeRect(r,i,d,a),e.restore(),e.save(),e.globalAlpha=.1,e.fillRect(o/2-1,i,2,a),e.restore(),e.fillRect(n.leftPaddle.posX,n.leftPaddle.posY,t.paddle.width,t.paddle.height),e.fillRect(n.rightPaddle.posX,n.rightPaddle.posY,t.paddle.width,t.paddle.height),e.beginPath(),e.arc(n.ball.pos.x,n.ball.pos.y,n.ball.radius,0,Math.PI*2),e.fill(),e.font="20px sans-serif",e.textAlign="left",e.fillText(`LEFT: ${n.score.left}`,r,i-14),e.textAlign="right",e.fillText(`RIGHT: ${n.score.right}`,r+d,i-14),e.font="bold 24px sans-serif",e.textAlign="center",e.fillText(`Round ${n.round}`,r+d/2,i-14),e.font="14px sans-serif",e.textAlign="left",e.fillText(`Wins: ${n.roundWins.left}`,r,i+a+24),e.textAlign="right",e.fillText(`Wins: ${n.roundWins.right}`,r+d,i+a+24),n.roundWinner&&(e.textAlign="center",e.font="14px sans-serif",e.fillText(`Last round: ${n.roundWinner.toUpperCase()} win`,r+d/2,i+a+24)),n.status==="ended"&&n.winner&&(e.font="bold 32px sans-serif",e.textAlign="center",e.fillText(`WIN: ${n.winner.toUpperCase()}`,o/2,s/2-20))}function v(e,n,t,o){const s=e.leftPaddle,r=e.rightPaddle,i=n.paddle.speed;s.vy=(t.state.upLeft?-1:0)+(t.state.dwLeft?1:0),r.vy=(t.state.upRight?-1:0)+(t.state.dwRight?1:0),s.posY+=s.vy*i*o,r.posY+=r.vy*i*o;const d=y(n),a=d.top,u=d.bottom-n.paddle.height;s.posY=Math.max(a,Math.min(u,s.posY)),r.posY=Math.max(a,Math.min(u,r.posY))}function M(e,n,t){if(e.status!=="playing")return null;const o=e.ball,s=o.radius,r=y(n);o.pos.x+=o.vel.x*t,o.pos.y+=o.vel.y*t,o.pos.y-s<=r.top&&o.vel.y<0&&(o.pos.y=s+r.top,o.vel.y*=-1),o.pos.y+s>=r.bottom&&o.vel.y>0&&(o.pos.y=r.bottom-s,o.vel.y*=-1);const i=(d,a)=>{if(o.pos.y>=d.posY&&o.pos.y<=d.posY+d.height){if(a==="L"){if(o.pos.x-s<=d.posX+d.width&&o.vel.x<0&&o.pos.x>d.posX){o.pos.x=d.posX+d.width+s,o.vel.x*=-1;const h=(o.pos.y-(d.posY+d.height/2))/(d.height/2);o.vel.y+=h*60}}else if(o.pos.x+s>=d.posX&&o.vel.x>0&&o.pos.x<d.posX+d.width){o.pos.x=d.posX-s,o.vel.x*=-1;const h=(o.pos.y-(d.posY+d.height/2))/(d.height/2);o.vel.y+=h*60}}};return i(e.leftPaddle,"L"),i(e.rightPaddle,"R"),o.pos.x+s<r.left?"right":o.pos.x-s>r.right?"left":null}function T(e,n){const t=document.createElement("div");t.style.position="fixed",t.style.inset="0",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.style.background="rgba(0,0,0,0.45)",t.style.zIndex="1000",t.setAttribute("aria-hidden","true");const o=document.createElement("div");o.style.minWidth="280px",o.style.maxWidth="90vw",o.style.background="#111",o.style.color="#fff",o.style.padding="20px 16px",o.style.borderRadius="16px",o.style.boxShadow="0 10px 30px rgba(0,0,0,0.4)",o.style.textAlign="center",o.setAttribute("role","dialog"),o.setAttribute("aria-modal","true"),o.tabIndex=-1;const s=document.createElement("h2"),r="result-dialog-title";s.id=r,s.style.margin="0 0 8px",s.style.fontSize="20px";const i=document.createElement("p"),d="result-dialog-desc";i.id=d,i.style.margin="0 0 16px",i.style.opacity="0.8",o.setAttribute("aria-labelledby",r),o.setAttribute("aria-describedby",d);const a=document.createElement("div");a.style.display="flex",a.style.gap="8px",a.style.justifyContent="center";const u=document.createElement("a");u.href=n.lobby,u.textContent="Exit (Lobby)",u.style.padding="10px 14px",u.style.borderRadius="10px",u.style.background="#fafafa",u.style.color="#111",u.style.textDecoration="none",u.style.fontWeight="600";const p=document.createElement("button");p.type="button",p.textContent="Next round",p.style.padding="10px 14px",p.style.border="1px solid #fff",p.style.borderRadius="10px",p.style.textDecoration="none",p.style.color="#fff",p.style.fontWeight="600",a.appendChild(u),a.appendChild(p),o.appendChild(s),o.appendChild(i),o.appendChild(a),t.appendChild(o),e.appendChild(t);let h=null;const m=c=>{c.target===t&&f.hide()},l=c=>{c.key==="Escape"&&f.hide()};p.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),t.dispatchEvent(new CustomEvent("next-round"))});const f={el:t,show(c){s.textContent=`WIN: ${c.toUpperCase()}`,i.textContent="Game ended",t.style.display="flex",t.setAttribute("aria-hidden","false"),h=document.activeElement??null,requestAnimationFrame(()=>{u.focus()}),t.addEventListener("click",m),document.addEventListener("keydown",l)},hide(){var c;t.style.display="none",t.setAttribute("aria-hidden","true"),t.removeEventListener("click",m),document.removeEventListener("keydown",l),(c=h==null?void 0:h.focus)==null||c.call(h)},destroy(){this.hide(),e.removeChild(t)}};return f}function I(e){const n=g,t=P(n),o=E(),s=document.createElement("canvas");s.width=n.court.width,s.height=n.court.height,e.appendChild(s);const r=s.getContext("2d"),i=T(e,{lobby:"/lobby"});function d(){t.round+=1,t.score.left=0,t.score.right=0,t.roundWinner=null,x(t,n),b(t,n)}i.el.addEventListener("next-round",l=>{l.preventDefault(),l.stopPropagation(),t.status!=="ended"&&(d(),i.hide())});const a=o.attach(window);function u(l){if(t.score[l]+=1,t.score[l]>=n.winScore){if(t.roundWinner=l,t.roundWins[l]+=1,t.roundWins[l]>=t.roundsToWin){t.matchWinner=l,t.winner=l,t.status="ended",i.show(l);return}t.status="ready",i.show(l);return}const f=l==="left"?"right":"left";x(t,n),b(t,n,f)}let p=0,h=performance.now();function m(l){p=requestAnimationFrame(m);const f=Math.min(.033,(l-h)/1e3);if(h=l,o.state.reset&&(x(t,n),b(t,n),o.state.reset=!1),v(t,n,o,f),!o.state.pause&&t.status==="playing"){v(t,n,o,f);const c=M(t,n,f);c&&u(c)}L(r,t,n)}return x(t,n),b(t,n),requestAnimationFrame(l=>{h=l,m(l)}),()=>{cancelAnimationFrame(p),a(),i.destroy(),e.removeChild(s)}}function Y(e,n){var r;const t=((r=n.params)==null?void 0:r.matchId)??"unknown";e.innerHTML=`
		<section class="py-6 md:py-8 lg:py-10 space-y-4">
      		<h1 class="text-2xl sm:text-3xl lg:text-4xl font-bold">
				Game <span class="text-sm font-normal text-gray-500">(id: ${t})</span>
			</h1>

			<div id="game-root" class="w-full"></div>

			<!-- HUD slots placeholder -->
			<div id="hud" class="grid grid-cols-2 gap-3 text-sm">
				<div class="rounded border p-3">HUD: Score</div>
				<div class="rounded border p-3">HUD: Controls</div>
			</div>
    	</section>`;const o=e.querySelector("#game-root"),s=I(o);return()=>{s()}}export{Y as default};
