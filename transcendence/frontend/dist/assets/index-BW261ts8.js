(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const R="modulepreload",k=function(e){return"/"+e},O={},f=function(n,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(u=>{if(u=k(u),u in O)return;O[u]=!0;const l=u.endsWith(".css"),g=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${g}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":R,l||(c.as="script"),c.crossOrigin="",c.href=u,i&&c.setAttribute("nonce",i),document.head.appendChild(c),l)return new Promise((m,p)=>{c.addEventListener("load",m),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return r.then(a=>{for(const i of a||[])i.status==="rejected"&&o(i.reason);return n().catch(o)})},I="ft_transcendence_version1";function $(){try{const e=sessionStorage.getItem(I);return e?JSON.parse(e):void 0}catch{return}}function T(e){try{sessionStorage.setItem(I,JSON.stringify(e))}catch{}}const h=$()??{session:{},tournament:{}},w=new Set;function _(){T(h);for(const e of w)e(h)}function V(e){return w.add(e),()=>w.delete(e)}function b(){return h}function X(e){h.session.alias=e.trim()||void 0,_()}function x(e){h.tournament.currentId=e,_()}function G(e,n="pending"){h.myMatch={id:e,type:"tournament",status:n,tournamentId:h.tournament.currentId},_()}function j(e){h.myMatch&&(h.myMatch.status=e,_())}function A(e){const n=b(),t=n.myMatch;return e.startsWith("local-")?n.session.lastLocalMatchId===e?{ok:!0}:{ok:!1,redirect:"/local",reason:"invalid-local-match"}:(t==null?void 0:t.type)==="tournament"&&t.id===e?t.status==="ready"||t.status==="playing"?{ok:!0}:{ok:!1,redirect:`/tournaments/${t.tournamentId??""}`,reason:`match-${t.status}`}:{ok:!1,redirect:"/",reason:"no-match-bound"}}const P="ft_transcendence_version1",S="http://localhost:3000/user-service";function y(){try{return JSON.parse(sessionStorage.getItem(P)||"{}")}catch{return{}}}function E(e){sessionStorage.setItem(P,JSON.stringify(e))}function D(){var e,n;return((n=(e=y())==null?void 0:e.auth)==null?void 0:n.user)??null}async function J(e,n,t){try{const s=await fetch(`${S}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:n,password:t})}),r=await s.json();if(!s.ok)return{success:!1,error:r.message||r.error||"Registration failed"};if(r.token){const o=y();return o.auth||(o.auth={user:null,token:null}),o.auth.user={id:r.user.id,username:r.user.username,email:r.user.email,name:r.user.username,role:"user"},o.auth.token=r.token,E(o),dispatchEvent(new CustomEvent("auth:changed")),{success:!0}}return{success:!0}}catch(s){return console.error("Register error:",s),{success:!1,error:s instanceof Error?s.message:"Network error"}}}async function K(e,n){try{const t=await fetch(`${S}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:n})}),s=await t.json();if(!t.ok)return{success:!1,error:s.message||s.error||"Login failed"};const r=y();return r.auth||(r.auth={user:null,token:null}),r.auth.user={id:s.user.id,username:s.user.username,email:s.user.email,name:s.user.username,role:"user"},r.auth.token=s.token,E(r),dispatchEvent(new CustomEvent("auth:changed")),{success:!0}}catch(t){return console.error("Sign in error:",t),{success:!1,error:t instanceof Error?t.message:"Network error"}}}async function M(){const e=y();e.auth||(e.auth={user:null,token:null}),e.auth.user=null,e.auth.token=null,E(e),dispatchEvent(new CustomEvent("auth:changed"))}async function U(e){try{console.log("ðŸŽ® Guest login with alias:",e||"auto-generated");const n=await fetch(`${S}/auth/guest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({alias:e||void 0})}),t=await n.json();if(console.log("Guest login response:",t),!n.ok||!t.success)return{success:!1,error:t.message||t.error||"Guest login failed"};const s=y();return s.auth||(s.auth={user:null,token:null}),s.auth.user={id:t.user.id,username:t.user.username,email:t.user.email,name:t.user.username,role:"user"},s.auth.token=t.token,E(s),dispatchEvent(new CustomEvent("auth:changed")),console.log("âœ… Guest user created in DB with ID:",t.user.id),{success:!0}}catch(n){return console.error("âŒ Guest login error:",n),{success:!1,error:n instanceof Error?n.message:"Network error"}}}const N=[[/^\/$/,()=>f(()=>import("./lobby-VFtmwJUA.js"),[])],[/^\/lobby$/,()=>f(()=>import("./lobby-VFtmwJUA.js"),[])],[/^\/init$/,()=>f(()=>import("./init-DAhhF_Iu.js"),[])],[/^\/local$/,()=>f(()=>import("./local-DduN0k0X.js"),[])],[/^\/tournaments$/,()=>f(()=>import("./tournaments-C2u1dny9.js"),[])],[/^\/tournaments\/([^/]+)$/,()=>f(()=>import("./tournament-detail-BOW1Jbin.js"),[])],[/^\/tournament\/next$/,()=>f(()=>import("./tournament-next-BXgDJ45s.js"),[])],[/^\/game\/([^/]+)$/,()=>f(()=>import("./game-DbYIl3sv.js"),[])],[/^\/auth$/,()=>f(()=>import("./auth-BsXw-0eC.js"),[])],[/^\/profile$/,()=>f(()=>import("./profile-DocEnDL2.js"),[])]];function Y(e){let n;if(e.hasAttribute("tabindex")||e.setAttribute("tabindex","-1"),"scrollRestoration"in history)try{history.scrollRestoration="manual"}catch{}function t(){const o=history.state??{};try{history.replaceState({...o,scrollX:window.scrollX,scrollY:window.scrollY},"",location.pathname+location.search)}catch{}}async function s(o){n==null||n();const a=new URL(o,location.origin),i=a.pathname,u=N.find(([d])=>d.test(i));if(!u){n=(await f(()=>import("./not-found-QyU_JPSc.js"),[])).default(e,{url:a})||void 0,r();return}const[l,g]=u,c=i.match(l);if(l.source==="^\\/profile$"&&!D()){const d=`/auth?next=${encodeURIComponent(i+a.search)}`;history.replaceState({scrollX:0,scrollY:0},"",d),await s(d);return}if(l.source==="^\\/game\\/([^/]+)$"){const d=c[1],v=A(d);if(!v.ok){history.replaceState({scrollX:0,scrollY:0},"",v.redirect),await s(v.redirect);return}}const m=await g(c);let p;if(c[1]){const d=c[1];p={id:d},l.source==="^\\/game\\/([^/]+)$"&&(p.matchId=d),l.source==="^\\/tournaments\\/([^/]+)$"&&(p.tournamentId=d)}n=m.default(e,{params:p,url:a})||void 0,r()}document.addEventListener("click",o=>{var c,m;const a=(m=(c=o.target).closest)==null?void 0:m.call(c,"a[href]");if(!a)return;const i=o;if(i.defaultPrevented||i.button!==0||i.metaKey||i.ctrlKey||i.shiftKey||i.altKey)return;const u=new URL(a.href,location.origin);if(u.origin!==location.origin)return;const l=u.pathname+u.search,g=location.pathname+location.search;if(l===g){o.preventDefault();return}o.preventDefault(),t(),history.pushState({scrollX:0,scrollY:0},"",l),s(l)}),window.addEventListener("popstate",o=>{s(location.pathname+location.search);const a=o.state??{};typeof a.scrollY=="number"&&window.scrollTo(a.scrollX??0,a.scrollY)});function r(){e.focus({preventScroll:!0})}return s(location.pathname+location.search),{render:s}}function q(e){const n=e.startsWith("/")?e:"/"+e;try{const t=history.state??{};history.replaceState({...t,scrollX:window.scrollX,scrollY:window.scrollY},"",location.pathname+location.search)}catch{}history.pushState({scrollX:0,scrollY:0},"",n),dispatchEvent(new PopStateEvent("popstate"))}const L=document.querySelector("main#app");if(!L)throw new Error("Root element #app not found");const{render:C}=Y(L);C(location.pathname+location.search);export{b as a,M as b,x as c,X as d,G as e,j as f,D as g,K as h,U as i,q as n,J as r,V as s};
